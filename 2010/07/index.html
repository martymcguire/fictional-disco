<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Marty McGuire is a freelance web developer in Baltimore, MD. He can also be found tinkering with electronics, 3D printing, and performing improv comedy.
">
  
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="webmention" href="https://webmention.io/martymcgui.re/webmention" />
  <link rel="shortcut icon" href="https://heady-land.glitch.me/images/logo.jpg" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="apple-touch-icon" href="https://heady-land.glitch.me/images/logo.jpg" />

  <link rel="stylesheet" href="https://heady-land.glitch.me/css/main.css">

  <link rel="canonical" href="https://heady-land.glitch.me/2010/07/">
  
</head>


  <body>

    <nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="https://heady-land.glitch.me/">
        <img alt="Marty McGuire" src="https://heady-land.glitch.me/img/logo.jpg">
      </a>
      <a class="navbar-brand" href="https://heady-land.glitch.me/">martymcgui.re</a>
    </div>
  </div>
</nav>

        
  <h2>Archive for July 2010</h2>

  <div class="posts-collection">
    <div class="sidebar-nav">
      <ul>
      <li >
          <details >
            <summary><a href="/2018/">2018</a></summary>
            <ul>
                <li ><a href="/2018/11/">November</a></li>
                <li ><a href="/2018/10/">October</a></li>
                <li ><a href="/2018/09/">September</a></li>
                <li ><a href="/2018/08/">August</a></li>
                <li ><a href="/2018/07/">July</a></li>
                <li ><a href="/2018/06/">June</a></li>
                <li ><a href="/2018/05/">May</a></li>
                <li ><a href="/2018/04/">April</a></li>
                <li ><a href="/2018/03/">March</a></li>
                <li ><a href="/2018/02/">February</a></li>
                <li ><a href="/2018/01/">January</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2017/">2017</a></summary>
            <ul>
                <li ><a href="/2017/12/">December</a></li>
                <li ><a href="/2017/11/">November</a></li>
                <li ><a href="/2017/10/">October</a></li>
                <li ><a href="/2017/09/">September</a></li>
                <li ><a href="/2017/08/">August</a></li>
                <li ><a href="/2017/07/">July</a></li>
                <li ><a href="/2017/06/">June</a></li>
                <li ><a href="/2017/05/">May</a></li>
                <li ><a href="/2017/04/">April</a></li>
                <li ><a href="/2017/03/">March</a></li>
                <li ><a href="/2017/02/">February</a></li>
                <li ><a href="/2017/01/">January</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2016/">2016</a></summary>
            <ul>
                <li ><a href="/2016/12/">December</a></li>
                <li ><a href="/2016/11/">November</a></li>
                <li ><a href="/2016/10/">October</a></li>
                <li ><a href="/2016/09/">September</a></li>
                <li ><a href="/2016/08/">August</a></li>
                <li ><a href="/2016/07/">July</a></li>
                <li ><a href="/2016/06/">June</a></li>
                <li ><a href="/2016/05/">May</a></li>
                <li ><a href="/2016/04/">April</a></li>
                <li ><a href="/2016/03/">March</a></li>
                <li ><a href="/2016/02/">February</a></li>
                <li ><a href="/2016/01/">January</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2015/">2015</a></summary>
            <ul>
                <li ><a href="/2015/12/">December</a></li>
                <li ><a href="/2015/11/">November</a></li>
                <li ><a href="/2015/10/">October</a></li>
                <li ><a href="/2015/09/">September</a></li>
                <li ><a href="/2015/07/">July</a></li>
                <li ><a href="/2015/06/">June</a></li>
                <li ><a href="/2015/04/">April</a></li>
                <li ><a href="/2015/02/">February</a></li>
                <li ><a href="/2015/01/">January</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2014/">2014</a></summary>
            <ul>
                <li ><a href="/2014/12/">December</a></li>
                <li ><a href="/2014/11/">November</a></li>
                <li ><a href="/2014/10/">October</a></li>
                <li ><a href="/2014/09/">September</a></li>
                <li ><a href="/2014/08/">August</a></li>
                <li ><a href="/2014/07/">July</a></li>
                <li ><a href="/2014/06/">June</a></li>
                <li ><a href="/2014/05/">May</a></li>
                <li ><a href="/2014/02/">February</a></li>
                <li ><a href="/2014/01/">January</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2013/">2013</a></summary>
            <ul>
                <li ><a href="/2013/12/">December</a></li>
                <li ><a href="/2013/11/">November</a></li>
                <li ><a href="/2013/10/">October</a></li>
                <li ><a href="/2013/08/">August</a></li>
                <li ><a href="/2013/07/">July</a></li>
                <li ><a href="/2013/06/">June</a></li>
                <li ><a href="/2013/05/">May</a></li>
                <li ><a href="/2013/04/">April</a></li>
                <li ><a href="/2013/03/">March</a></li>
                <li ><a href="/2013/02/">February</a></li>
                <li ><a href="/2013/01/">January</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2012/">2012</a></summary>
            <ul>
                <li ><a href="/2012/12/">December</a></li>
                <li ><a href="/2012/10/">October</a></li>
                <li ><a href="/2012/09/">September</a></li>
                <li ><a href="/2012/08/">August</a></li>
                <li ><a href="/2012/07/">July</a></li>
                <li ><a href="/2012/06/">June</a></li>
                <li ><a href="/2012/05/">May</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2011/">2011</a></summary>
            <ul>
                <li ><a href="/2011/11/">November</a></li>
                <li ><a href="/2011/10/">October</a></li>
                <li ><a href="/2011/09/">September</a></li>
                <li ><a href="/2011/02/">February</a></li>
                </ul>
              </details>
        </li>
      <li class="current">
          <details open>
            <summary><a href="/2010/">2010</a></summary>
            <ul>
                <li ><a href="/2010/10/">October</a></li>
                <li ><a href="/2010/08/">August</a></li>
                <li class="current"><a href="/2010/07/">July</a></li>
                <li ><a href="/2010/06/">June</a></li>
                <li ><a href="/2010/03/">March</a></li>
                <li ><a href="/2010/02/">February</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2009/">2009</a></summary>
            <ul>
                <li ><a href="/2009/02/">February</a></li>
                </ul>
              </details>
        </li>
      <li >
          <details >
            <summary><a href="/2008/">2008</a></summary>
            <ul>
                <li ><a href="/2008/06/">June</a></li>
                <li ><a href="/2008/05/">May</a></li>
                </ul>
              </details>
        </li>
      </ul>
    </div>
		
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
				<div class="date-separator"><a name="2010-07-25"></a>Sun Jul 25</div>
				<article class="post-content h-entry">
  <h1 class="post-title p-name"><a href="/2010/07/25/automatic-makerbot-camera-pt.-4---updating-replicatorg/">Automatic MakerBot Camera Pt. 4 - Updating ReplicatorG</a></h1>
    
    
    
    
    
    
    
    
    
  
  
    
    <div class="post e-content">
<p>In the previous posts in this series, I <a href="/howto/makerbot-cam-1-chdk/">hacked up a Canon camera</a> to take pictures with an electronic trigger, <a href="/howto/makerbot-cam-2-wiring/">built a cable</a> to connect the camera to my MakerBot, and <a href="/howto/makerbot-cam-3-firmware/">hacked the MakerBot&rsquo;s firmware</a> to enable it to trigger the camera in response to commands from the controlling computer.</p>

<p><a href="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check31.png"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check31.png" alt="" title="MakerBot camera communications diagram, all done (except the PC)." width="513" height="139" class="alignnone size-full wp-image-212" /></a></p>

<p>The final step was to hack the desktop software that controls the MakerBot - ReplicatorG.</p>

<h3>What is ReplicatorG?</h3>

<p>From the <a href="http://replicat.org/">ReplicatorG website</a>:</p>

<blockquote>[ReplicatorG] is the software that will drive your CupCake CNC, RepRap machine, or generic CNC machine. You can give it a GCode or STL file to process, and it takes it from there. Its cross platform, easily installed, and is based on the familiar Arduino / Processing environments.</blockquote>

<p>For my purposes, ReplicatorG provides two things. First, RepG is a user interface for controlling the MakerBot hardware:</p>

<p><a href="http://www.flickr.com/photos/phooky/4604290256/sizes/o/"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/replicator_g_control_panel.png" alt="" title="RepG extruder control panel. Image by phooky, CC-BY-SA." width="426" height="437" class="alignnone size-full wp-image-218" /></a></p>

<p>Second, RepG reads <a href="http://en.wikipedia.org/wiki/G-code">G-code</a> files describing how to build an object, and transmits them to the MakerBot over the USB:</p>

<p><a href="http://www.flickr.com/photos/makerbot/4816221120/sizes/m/"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/repg_gcode.jpg" alt="" title="RepG G-code viewer. Image by makerbot, CC-BY." width="476" height="500" class="alignnone size-full wp-image-220" /></a></p>

<p>Of course, ReplicatorG is open source, and the code is <a href="http://github.com/makerbot/ReplicatorG">available on GitHub</a>!  So, it was simple to clone their repository and start hacking on it myself.</p>

<h3>Camera Control via ReplicatorG</h3>

<p>While it was relatively simple to update the extruder controller firmware to make it camera-aware, ReplicatorG is a bit more complicated.  My first goal was to hack a new &ldquo;Camera&rdquo; checkbox into the control panel.  Whenever the box was checked, the camera would take pictures. Whenever the box was unchecked, the camera would be idle.</p>

<p>You can find the code required for these changes in <a href="http://github.com/martymcguire/ReplicatorG/commit/6b967b4e7dd115a674c3e223d3abc7119ab44c1a">this commit on GitHub</a>, but I will try to briefly break them down here:
<ul>
    <li><strong>Define a new machine</strong>.  In the <code>machines.xml.dist</code> file, I defined an experimental MakerBot configuration named &ldquo;EXPERIMENTAL - Cupcake CNC w/HBP and remote camera&rdquo;.  It is essentially a copy of the typical MakerBot configuration with a heated build platform, but in the <code>&lt;tool&gt;</code> definition, I also added a <code>camera=&ldquo;true&rdquo;</code> attribute.</li>
        <li><strong>Update the tool model</strong>. In <code>ToolModel.java</code>, I added code to represent whether the tool has an attached camera, whether the camera is activated, and how to parse the <code>camera</code> attribute out of <code>machines.xml</code>.</li>
    <li><strong>Update the machine driver model</strong>.  In <code>Driver.java</code>, <code>DriverBaseImplementation.java</code>, and <code>Sanguino3GDriver.java</code>, I added the definitions and implementations to <code>triggerCamera()</code> and <code>stopTriggeringCamera()</code>.  This is the code that actually sends the <code>TOGGLE_CAMERA</code> serial command to the extruder controller, which I also defined in <code>ToolCommandCode.java</code>.</li>
    <li><strong>Update the control panel interface</strong>. In <code>ExtruderPanel.java</code>, I added the code to draw a new label and checkbox named &ldquo;Camera&rdquo;, if the machine is configured for a camera, and to respond to check/uncheck events by calling <code>triggerCamera()</code> or <code>stopTriggeringCamera()</code>.</li>
</ul></p>

<h3>Compiling and Running the new ReplicatorG</h3>

<p>Compiling ReplicatorG is pretty simple, so long as you have a reasonable JDK environment and have Ant on your path.  There are basically two steps:</p>

<ol>
<li>Copy <code>machines.xml.dist to</code>machines.xml`.</li>
<li>Run the proper <code>dist-linux.sh</code>, <code>dist-mac.sh</code>, or <code>dist-windows.sh</code>.</li>
</ol>

<p>ReplicatorG will be compiled and packaged up into the <code>dist/</code> directory in two forms: an installable package for the chosen platform, and an unpacked version that you can run directly.</p>

<p>Opening up my modified version of ReplicatorG, I selected the &ldquo;EXPERIMENTAL - Cupcake CNC w/HBP and remote camera&rdquo; profile from the <strong>Machine -&gt; Driver</strong> menu, opened up the control panel, and was happy to see this:</p>

<p><a href="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/control-panel-cam.png"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/control-panel-cam.png" alt="" title="RepG control panel... with camera trigger! It's down there, I swear." width="446" height="474" class="alignnone size-full wp-image-234" /></a></p>

<p>After hooking up my camera to the extruder controller&rsquo;s <code>D9</code> port, and starting the <code>Remote Button</code> script on the camera, I was able to take pictures by quickly toggling the camera checkbox on and off.  I could also leave the checkbox activated to make the camera take pictures continuously.</p>

<h3>Automatic Triggering with G-codes</h3>

<p>Being able to trigger the camera by hand is all well and good, but my goal was to take pictures automatically at the end of every layer.  To do this, I needed to be able to embed camera trigger commands in the G-code for building each individual object.</p>

<p>Looking at the <a href="http://replicat.org/gcodes">ReplicatorG G-code docs</a>, and the (machine-specific) <a href="http://replicat.org/mcodes">M-code docs</a>, I chose two codes for working with the camera:</p>

<ul>
<li><code>M150</code> - Trigger Camera</li>
<li><code>M151</code> - Stop Triggering Camera</li>
</ul>

<p>I may have to change these in the future, as the main ReplicatorG development team claim G- and M-codes for other features, but these work for now.</p>

<p>Modifying ReplicatorG to accept these M-codes (<a href="http://github.com/martymcguire/ReplicatorG/commit/876732b6a70bdaf4389476bfdf240d629ee50017">GitHub commit here</a>) was straightforward: update <code>GCodeParser.java</code> to recognize the codes, and call the appropriate <code>triggerCamera()</code> and <code>stopTriggeringCamera()</code> methods.</p>

<p>I could now construct a G-code file which, when &ldquo;built&rdquo; in ReplicatorG, would take a picture on demand:</p>

<pre><code>M150     (trigger the camera)
G4 P700  (wait 0.7 seconds for the camera to activate)
M151     (stop triggering)
G4 P1300 (wait 1.3 seconds for the camera to finish)
</code></pre>

<p>Finally, it was time to edit up the G-code for the models I want to photograph.</p>

<p>Typically, G-code is generated by taking a 3D object in STL format and running it through the <a href="http://www.bitsfrombytes.com/wiki/index.php?title=Skeinforge">Skeinforge</a> tool.  Skeinforge is a set of Python scripts, which means it is not too difficult to insert your own code.</p>

<p>For now, however, I decided to make a simple hack using a Perl script I wrote called <code>add_camera_events.pl</code>.  It works by looking for <code>(&lt;/layer&gt;)</code> comments, which signal the end of a layer of printing, and inserts lines to:
<ol>
    <li>Move to a standard pose (<code>X=0, Y=-45</code>),</li>
    <li>Trigger the camera and wait for it to finish, and</li>
    <li>Move back to the original position</li>
</ol></p>

<p>You can find the source for this script in the <a href="https://gist.github.com/489805">add_camera_events.pl gist</a>.  The source for all of my changes to ReplicatorG are on GitHub, in the &ldquo;schmarty-camera&rdquo; branch of <a href="http://github.com/martymcguire/ReplicatorG/tree/schmarty-camera">my fork of ReplicatorG</a>.</p>

<p>And with that, the computer aspect of this system was finally done!</p>

<p><a href="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check4.png"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check4.png" alt="" title="Computer, motherboard, extruder controller, camera - all complete!" width="513" class="alignnone size-full wp-image-254" /></a></p>

<h3>Wrap Up</h3>

<p>Phew!  So far I&rsquo;ve hacked a camera, wired it to the MakerBot, updated the MakerBot firmware to trigger it, updated ReplicatorG to trigger it, and written a script to update G-code files with camera triggers at the end of each layer.</p>

<p>So&hellip; does it work?  <a href="/makerbot/automatic-makerbot-time-lapse-photography/">You bet</a>!  Stay tuned for more examples and a breakdown video of this whole project in the final post in this series!</p>

<ul>
    <li><a href="/2010/02/01/000000/">Part 1: Remote control camera with CHDK</a></li>
    <li><a href="/2010/02/16/000000/">Part 2: Wiring it up!</a></li>
    <li><a href="/2010/07/16/000000/">Part 3: Updating the MakerBot Firmware</a></li>
    <li>Part 4: Updating ReplicatorG [YOU ARE HERE]</li>
    <li>Part 5: Printing with the Camera!</li>
</ul>
</div>
    
  
  






































































































  <div class="post-meta">
  
    <div class="post-tags">
      
      
        <a href="/tag/camera/" class="label label-default">#<span class="p-category">camera</span></a>

      
        <a href="/tag/g-code/" class="label label-default">#<span class="p-category">g-code</span></a>

      
        <a href="/tag/makerbot/" class="label label-default">#<span class="p-category">MakerBot</span></a>

      
        <a href="/tag/replicatorg/" class="label label-default">#<span class="p-category">replicatorg</span></a>

      
    </div>
  
  <div>
    <a rel="shortlink" type="text/html" href="http://mmg.re/46v400"><i class="fa fa-link" aria-label="Short link to this post" title="Shortlink to this post"></i></a>
    <a class="u-url" href="https://heady-land.glitch.me/2010/07/25/automatic-makerbot-camera-pt.-4---updating-replicatorg/"><time class="dt-published" datetime="2010-07-25T00:00:00-0400">July 25, 2010 at 12:00AM -0400</time></a> • by <a rel="author" class="p-author h-card" href="https://martymcgui.re/"><img class="byline-photo u-photo" src="https://martymcgui.re/images/logo.jpg" alt="Marty McGuire"/>Marty McGuire</a>
  </div>
  <div>
    

  

  


  </div>
</div>

  </article>

      
    
				<div class="date-separator"><a name="2010-07-22"></a>Thu Jul 22</div>
				<article class="post-content h-entry">
  <h1 class="post-title p-name"><a href="/2010/07/22/space-filling-with-3d-objects-using-processing/">Space filling with 3D objects using Processing</a></h1>
    
    
    
    
    
    
    
    
    
  
  
    
    <div class="post e-content">
<p><a href="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/makerbotiverse3.png"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/makerbotiverse3.png" alt="" title="MakerBot &quot;M&quot; logo filled with Thingiverse objects." width="462" height="549" class="alignnone size-full wp-image-184" /></a></p>

<p>While I know I should be finishing my <a href="/howto/makerbot-cam-1-chdk/">MakerBot</a> <a href="/howto/makerbot-cam-2-wiring/">time-lapse</a> <a href="/howto/makerbot-cam-3-firmware/">camera</a> <a href="/makerbot/automatic-makerbot-time-lapse-photography/">series</a>, I took some time for another project to play with some <a href="http://processing.org/">Processing</a>.  The above image was rendered in Processing, in real time in just couple of minutes!</p>

<p>Basically, I wanted to take a simple shape, defined by an SVG path, and fill it with images of <a href="http://www.thingiverse.com/thing:1090">3D</a> <a href="http://www.thingiverse.com/thing:3465">objects</a> <a href="http://www.thingiverse.com/thing:3378">loaded</a> <a href="http://www.thingiverse.com/thing:1842">from</a> <a href="http://www.thingiverse.com/thing:1046">STL</a> <a href="http://www.thingiverse.com/thing:1224">files</a>.  Specifically, many wonderful MakerBot-printable objects from <a href="http://www.thingiverse.com/">Thingiverse</a>!</p>

<p>After some Googling around, I found out that this problem is basically a space-filling problem, similar to an excellent Processing sketch named <a href="http://www.openprocessing.org/visuals/?visualID=1811">Scattered Letters</a> by <a href="http://www.openprocessing.org/portal/?userID=1133">Algirdas Rascius</a>, but with a twist.</p>

<p>The basic algorithm is:
<ul>
<li>Load an SVG and render it to an off-screen buffer</li>
<li>Set <code>curr_size</code>, the size that STLs should be rendered, to <code>max_size</code></li>
<li>Choose a random STL model, give it a random orientation, and render it at the current size to an off-screen buffer</li>
<li>Try several times to place this model by giving it a random <code>x</code>,<code>y</code> position and checking it for a good fit:<ul>
<li>Each non-background pixel of the model&rsquo;s off-screen image should fit within the non-background pixels of the SVG&rsquo;s off-screen image.</li>
<li>Each non-background pixel of the model&rsquo;s off-screen image should NOT overlap with any non-background pixel of the main display.</li>
</ul></li>
<li>If a fitting position is found, render the model to the display.</li>
<li>Otherwise, shrink <code>curr_size</code> by a step and choose a new model.</li>
<li>If we drop below <code>min_size</code>, we should stop.</li>
</ul></p>

<p>You can find the <a href="http://github.com/martymcguire/ThingiverseCollage">code for my sketch, which I call ThingiverseCollage, on GitHub</a>.  To make it work, you&rsquo;ll need to follow the installation instructions in the <a href="http://github.com/martymcguire/ThingiverseCollage/blob/master/README">README</a> to install my (very slightly) modified version of the <a href="http://workshop.evolutionzone.com/unlekkerlib/">unlekkerLib for STL loading and rendering</a>.  I modified it to allow rendering to a <code>PGraphics</code> object, since it originally only allowed rendering to the main <code>PApplet</code>.</p>

<p>A note on STL files: unlekkerLib only loads STL files in the binary format.  It chokes dramatically on ASCII STL files, such as those exported from <a href="http://openscad.org/">OpenSCAD</a>.  I was able to use <a href="http://www.pleasantsoftware.com/developer/pleasant3d/index.shtml">Zaggo&rsquo;s excellent Pleasant3D</a> to load ASCII STLs and re-save them, which converts them to binary STLs.  As a bonus, Pleasant3D also allows you to orient objects in a way that will make them look most interesting when they are rendered down to 2D in the final image.</p>

<p>An example <code>M.svg</code>, as well as several objects from <a href="http://thingiverse.com/">Thingiverse</a> are included with the code to get started.  To use your own SVGs, I have had good luck using <a href="http://inkscape.org/">Inkscape</a> to draw or import shapes, and save them as the native &ldquo;Inkscape SVG&rdquo; or &ldquo;Plain SVG&rdquo; formats.  Some files might require hand-tweaking; for example, if the <code>width</code> and <code>height</code> header values are something like <code>&ldquo;100%&rdquo;</code> instead of a pixel value.</p>

<p>There is also some simple configuration in the sketch to allow the export of PDF files.  This is nice because the resulting PDF has full vector data, making it easily rescaled to any size you wish.  Unfortunately, the current PDF renderer for Processing renders <i>each triangle of each STL model</i> as a separate path, generating very complicated vector output, which tends to bring Inkscape to its knees.  I have had some luck with importing those files, rastering them out to PNG at a high resolution (e.g. 600 dpi), and using Inkscape&rsquo;s &ldquo;Trace Bitmap&rdquo; functionality to re-vectorize them, though this requires some cleanup by hand.</p>

<p>Anyway, this has been a fun little diversion for me for the last couple of days.  I hope that you folks find it useful!  Post your awesome pictures in the comments, here!</p>
</div>
    
  
  

































  <div class="post-meta">
  
    <div class="post-tags">
      
      
        <a href="/tag/processing/" class="label label-default">#<span class="p-category">Processing</span></a>

      
        <a href="/tag/space-filling/" class="label label-default">#<span class="p-category">space filling</span></a>

      
        <a href="/tag/stl/" class="label label-default">#<span class="p-category">STL</span></a>

      
        <a href="/tag/svg/" class="label label-default">#<span class="p-category">SVG</span></a>

      
        <a href="/tag/thingiverse/" class="label label-default">#<span class="p-category">thingiverse</span></a>

      
        <a href="/tag/unlekkerlib/" class="label label-default">#<span class="p-category">unlekkerLib</span></a>

      
    </div>
  
  <div>
    <a rel="shortlink" type="text/html" href="http://mmg.re/46s400"><i class="fa fa-link" aria-label="Short link to this post" title="Shortlink to this post"></i></a>
    <a class="u-url" href="https://heady-land.glitch.me/2010/07/22/space-filling-with-3d-objects-using-processing/"><time class="dt-published" datetime="2010-07-22T00:00:00-0400">July 22, 2010 at 12:00AM -0400</time></a> • by <a rel="author" class="p-author h-card" href="https://martymcgui.re/"><img class="byline-photo u-photo" src="https://martymcgui.re/images/logo.jpg" alt="Marty McGuire"/>Marty McGuire</a>
  </div>
  <div>
    

  

  


  </div>
</div>

  </article>

      
    
				<div class="date-separator"><a name="2010-07-16"></a>Fri Jul 16</div>
				<article class="post-content h-entry">
  <h1 class="post-title p-name"><a href="/2010/07/16/automatic-makerbot-camera-pt.-3--updating-the-makerbot-firmware/">Automatic MakerBot Camera Pt. 3 – Updating the MakerBot Firmware</a></h1>
    
    
    
    
    
    
    
    
    
  
  
    
    <div class="post e-content">
<p>In the previous post in this series, I figured out how to <a href="/howto/makerbot-cam-2-wiring/">wire up</a> my <a href="/howto/makerbot-cam-1-chdk/">hacked Canon SD300 with CHDK</a>.  I chose to use the &ldquo;D9&rdquo; port on the <a href="http://reprap.org/bin/view/Main/Extruder_Controller_2_2#Servo_Headers">Extruder controller board</a>, thinking that should make the software as simple as setting pin 9 to &ldquo;HIGH&rdquo; for a brief time whenever I wanted to trigger the camera.</p>

<p>The next step was to update the software on the extruder controller so that it could activate (and deactivate) the camera, in response to commands from the motherboard.
<h3><a style="text-decoration: none; color: #000" name="makerbot_comms">An aside on MakerBot communications</a></h3>
The MakerBot electronics ecosystem is comprised of 3 parts: your computer, the <a href="http://reprap.org/wiki/Motherboard_1.2">MakerBot&rsquo;s motherboard</a>, and the <a href="http://reprap.org/wiki/Extruder_Controller_2.2">extruder controller board</a>.  Your computer talks to the motherboard via a USB&lt;-&gt;TTL interface (such as this <a href="http://www.sparkfun.com/commerce/product_info.php?products_id=9718">FTDI cable from SparkFun</a>).  In turn, the motherboard communicates with the extruder using another serial protocol, <a href="http://en.wikipedia.org/wiki/EIA-485">RS-485</a>, over an ethernet cable.  Finally, the extruder triggers the camera via the custom cable I made in the <a href="/howto/makerbot-cam-2-wiring/">previous post</a>.</p>

<p><a href="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag.png"><img class="size-full wp-image-196 alignnone" style="margin: 10px;" title="MakerBot Communications Diagram - Computer, motherboard, extruder controller, camera" src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag.png" alt="" width="500"/></a></p>

<p>The software for all three components is available on <a href="http://github.com/">the indomitable GitHub</a>.  The software for your computer is called <a href="http://replicat.org/">ReplicatorG</a>, and the source can be found in the <a href="http://github.com/makerbot/ReplicatorG">MakerBot ReplicatorG GitHub repository</a>.  I&rsquo;ll talk more about ReplicatorG in the next post in this series.  For now, we want to focus on the <a href="http://github.com/makerbot/G3Firmware">MakerBot G3Firmware GitHub repository</a>, which contains the code for the motherboard (in the <a href="http://github.com/makerbot/G3Firmware/tree/master/SanguinoMaster/">SanguinoMaster</a> subdirectory), and for the extruder (in the <a href="http://github.com/makerbot/G3Firmware/tree/master/ArduinoSlaveExtruder/">ArduinoSlaveExtruder</a> directory).</p>

<p>Browsing through the code, we see that these components use their serial interfaces to send packets, where each command is represented by a number.  The commands for the motherboard can be found in the <a href="http://github.com/makerbot/G3Firmware/blob/master/SanguinoMaster/Commands.h">SanguinoMaster/Commands.h</a>, and those for the extruder can be found in <a href="http://github.com/makerbot/G3Firmware/blob/master/ArduinoSlaveExtruder/PacketProcessor.cpp">ArduinoSlaveExtruder/PacketProcessor.cpp</a>.</p>

<p>To send a message to the extruder - in this case, to activate or deactivate the camera - we must create a packet for the motherboard.  The <code>HOST_CMD_TOOL_QUERY</code> code allows us to send the motherboard a packet which it will then pass along to the extruder controller.</p>

<p>That&rsquo;s great, because it means the motherboard part of this software hack is done!</p>

<p><a href="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check1.png"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check1.png" alt="" title="Motherboard - Check!" width="500" height="139" class="alignnone size-full wp-image-208" /></a></p>

<p>In fact, we&rsquo;ve already hacked the camera, as well, so we&rsquo;re halfway there!</p>

<p><a href="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check2.png"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check2.png" alt="" title="Camera: Check!" width="513" height="139" class="alignnone size-full wp-image-209" /></a></p>

<p><h3>Hacking a camera into the extruder controller</h3>
Since the motherboard already does everything we need (passes along packets from the computer to the extruder controller), we only need to update the ArduinoSlaveExtruder code.</p>

<p>To get this to work, I ended up changing the following files:
<a href="http://github.com/martymcguire/G3Firmware/commit/c7ff1ffb5f6004a37a0bcb2b5455403daac447d9#diff-0">ArduinoSlaveExtruder/Configuration.h.dist</a> - added in configuration options for enabling the camera and setting the pin on which to activate it.
<a href="http://github.com/martymcguire/G3Firmware/commit/c7ff1ffb5f6004a37a0bcb2b5455403daac447d9#diff-2">ArduinoSlaveExtruder/Extruder.h</a> - added function definitions for turning on/off the camera.
<a href="http://github.com/martymcguire/G3Firmware/commit/c7ff1ffb5f6004a37a0bcb2b5455403daac447d9#diff-1">ArduinoSlaveExtruder/Extruder.cpp</a> - actually implemented turning on/off the camera.
<a href="http://github.com/martymcguire/G3Firmware/commit/c7ff1ffb5f6004a37a0bcb2b5455403daac447d9#diff-3">ArduinoSlaveExtruder/PacketProcessor.cpp</a> - implemented the serial command to toggle camera.
<h3>Building and uploading</h3>
If you followed the 4 links above, you&rsquo;ll notice that they go to <a href="http://github.com/martymcguire/G3Firmware/">my own G3Firmware GitHub repository</a>.  You can download it yourself to play along by cloning the repository and checking out the <code>ECv2.3rc0-camera</code> branch.</p>

<p>To build the firmware and upload it to the extruder controller, we need some common development tools (make, in this case), and the <a href="http://arduino.cc/">Arduino</a> development environment.  With those things installed, we can compile everything by setting the <code>ARDUINO_HOME</code> environment variable to the path to our Arduino install&rsquo;s java directory (e.g. on OS X this would be <code>/Applications/Arduino.app/Contents/Resources/Java/</code>), and simply run <code>make</code>.</p>

<p>Once the firmware has been compiled, we can upload it to the extruder controller by using the USB&lt;-&gt;TTL cable that usually connects the motherboard to our computer.  Plug the cable into the extruder controller, and run the <code>make upload</code> command.  You&rsquo;ll need to make sure that <code>ARDUINO_HOME</code> is set, and you will probably need to alter the Makefile to specify the correct serial port, and maybe to update the call to <code>avrdude</code> to include the path to the Arduino avrdude config file.  You can see an example of that in <a href="http://github.com/martymcguire/G3Firmware/commit/0b9c9b09a084f3ad08ccbac7016e82ad3814a3c1">this commit</a>.</p>

<p>Once the firmware is uploaded to the extruder controller, the MakerBot is all set to take pictures!</p>

<p><a href="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check3.png"><img src="http://s3.amazonaws.com/static.creatingwithcode.com/wp-content/uploads/2010/07/MB-comms-diag_check3.png" alt="" title="Extruder Controller - Check!" width="513" height="139" class="alignnone size-full wp-image-210" /></a></p>

<p>&hellip; Of course, we still have no way to <strong>tell</strong> the MakerBot to take a picture, so stay tuned for that information in the next update:
<ul>
    <li><a href="/2010/02/01/000000/">Part 1: Remote control camera with CHDK</a></li>
    <li><a href="/2010/02/16/000000/">Part 2: Wiring it up!</a></li>
    <li>Part 3: Updating the MakerBot Firmware [YOU ARE HERE]</li>
    <li><a href="/2010/07/25/000000/">Part 4: Updating ReplicatorG</a></li>
    <li>Part 5: Printing with the Camera!</li>
</ul></p>
</div>
    
  
  



















































  <div class="post-meta">
  
    <div class="post-tags">
      
      
        <a href="/tag/3d-printing/" class="label label-default">#<span class="p-category">3d printing</span></a>

      
        <a href="/tag/firmware/" class="label label-default">#<span class="p-category">firmware</span></a>

      
        <a href="/tag/makerbot/" class="label label-default">#<span class="p-category">MakerBot</span></a>

      
    </div>
  
  <div>
    <a rel="shortlink" type="text/html" href="http://mmg.re/46m400"><i class="fa fa-link" aria-label="Short link to this post" title="Shortlink to this post"></i></a>
    <a class="u-url" href="https://heady-land.glitch.me/2010/07/16/automatic-makerbot-camera-pt.-3--updating-the-makerbot-firmware/"><time class="dt-published" datetime="2010-07-16T00:00:00-0400">July 16, 2010 at 12:00AM -0400</time></a> • by <a rel="author" class="p-author h-card" href="https://martymcgui.re/"><img class="byline-photo u-photo" src="https://martymcgui.re/images/logo.jpg" alt="Marty McGuire"/>Marty McGuire</a>
  </div>
  <div>
    

  

  


  </div>
</div>

  </article>

      
    
				<div class="date-separator"><a name="2010-07-14"></a>Wed Jul 14</div>
				<article class="post-content h-entry">
  <h1 class="post-title p-name"><a href="/2010/07/14/automatic-makerbot-time-lapse-photography/">Automatic MakerBot Time-Lapse Photography!</a></h1>
    
    
    
    
    
    
    
    
    
  
  
    
    <div class="post e-content">
<iframe width="560" height="315" src="https://www.youtube.com/embed/kQns9DtSesE" frameborder="0" allowfullscreen></iframe>

<p>It works!</p>

<p>Using a Canon SD300 with <a href="http://chdk.wikia.com/wiki/CHDK">CHDK</a>, and some firmware hacks, Makerbot #131 has learned how to make time-lapse videos of all of its prints!</p>

<p>More details (and a how-to!) coming soon!  And thanks to <a href="http://www.thingiverse.com/">Thingiverse</a> user <a href="http://www.thingiverse.com/Starno">Starno</a> for the <a href="http://www.thingiverse.com/thing:1842">bottle opener model</a> in the video.</p>
</div>
    
  
  









  <div class="post-meta">
  
    <div class="post-tags">
      
      
        <a href="/tag/3d-printing/" class="label label-default">#<span class="p-category">3d printing</span></a>

      
        <a href="/tag/makerbot/" class="label label-default">#<span class="p-category">MakerBot</span></a>

      
        <a href="/tag/time-lapse/" class="label label-default">#<span class="p-category">time lapse</span></a>

      
        <a href="/tag/video/" class="label label-default">#<span class="p-category">video</span></a>

      
    </div>
  
  <div>
    <a rel="shortlink" type="text/html" href="http://mmg.re/46j400"><i class="fa fa-link" aria-label="Short link to this post" title="Shortlink to this post"></i></a>
    <a class="u-url" href="https://heady-land.glitch.me/2010/07/14/automatic-makerbot-time-lapse-photography/"><time class="dt-published" datetime="2010-07-14T00:00:00-0400">July 14, 2010 at 12:00AM -0400</time></a> • by <a rel="author" class="p-author h-card" href="https://martymcgui.re/"><img class="byline-photo u-photo" src="https://martymcgui.re/images/logo.jpg" alt="Marty McGuire"/>Marty McGuire</a>
  </div>
  <div>
    

  

  


  </div>
</div>

  </article>

      
    
    
    
    
    
    
    
    
    
    
    
  </div>

    

  </body>

</html>

